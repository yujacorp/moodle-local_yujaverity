{"version":3,"file":"checkQuizAccess.min.js","sources":["../src/checkQuizAccess.js"],"sourcesContent":["/**\n * Checks whether the YuJa Verity browser extension is enabled\n * @param {string} verityHostname hostname of Verity server\n * @returns {Promise<boolean>} whether the extension is enabled\n */\nfunction checkExtension(verityHostname) {\n    return new Promise((resolve, reject) => {\n        let iframe = document.createElement(\"iframe\");\n        iframe.id = \"yuja-verity-extension-connect\";\n        iframe.style.display = \"none\";\n        iframe.style.visibility = \"hidden\";\n        iframe.src = \"https://\" + verityHostname + \"/resources/themes/extension-connect.html\";\n        document.body.appendChild(iframe);\n        iframe.onload = () => {\n            iframe.contentWindow?.postMessage({\n                require: \"exists\"\n            }, \"https://\" + verityHostname);\n        };\n        iframe.onerror = () => {\n            reject();\n        };\n        window.addEventListener(\"message\", (ev) => {\n            if (ev.origin !== \"https://\" + verityHostname) {\n                return;\n            }\n\n            const message = ev.data;\n            if (message?.require === \"exists\") {\n                resolve(Boolean(message.result));\n            }\n        });\n    });\n}\n\n/**\n * Shows a page blocking access to the quiz\n * @param {string} verityHostname hostname of Verity server\n * @param {string} blockPage type of block page\n */\nfunction showBlockPage(verityHostname, blockPage) {\n    let quizDisplay = document.getElementById(\"region-main-box\");\n    if (!quizDisplay) {\n        return;\n    }\n\n    let notice = document.createElement(\"iframe\");\n    notice.id = \"yuja-download-instructions\";\n    notice.width = quizDisplay.offsetWidth;\n    notice.scrolling = \"no\";\n    notice.src = \"https://\" + verityHostname + \"/pages/take-quiz/block-access/\" + blockPage + \".html?lms=moodle\";\n    notice.style.border = \"none\";\n    notice.style.transition = \"all 0.5s ease-in-out 0s\";\n    notice.height = \"0px\";\n    notice.width = \"100%\";\n    notice.style.paddingLeft = \"15px\";\n    notice.style.paddingRight = \"15px\";\n\n    quizDisplay.style.display = \"none\";\n    quizDisplay.style.visibility = \"hidden\";\n    quizDisplay.parentNode.appendChild(notice);\n\n    notice.onload = () => {\n        notice.contentWindow.postMessage({\n            event: \"init-auth-instructions\",\n            authLink: undefined\n        }, \"https://\" + verityHostname);\n\n    };\n\n    window.addEventListener(\"message\", (ev) => {\n        if (ev.origin !== \"https://\" + verityHostname) {\n            return;\n        }\n\n        const message = ev.data;\n        if (message?.event === \"instructions-resize\") {\n            if (message.scrollHeight) {\n                notice.height = message.scrollHeight;\n            }\n            if (message.scrollWidth) {\n                notice.width = \"100%\";\n            }\n            if (!message.noScroll) {\n                document.documentElement.scrollTop = 0;\n            }\n        }\n    });\n}\n\n/**\n * Unhide the form hidden by course_module_viewed_handler in view_quiz.php\n */\nfunction showQuiz() {\n    document.body.classList.remove(\"yujaverity\");\n}\n\n/**\n * Hides quiz page and shows block page depending on user's browser (called from event)\n * @param {string} verityHostname hostname of Verity server\n */\nexport async function checkQuizAccess(verityHostname) {\n    try {\n        if (window.chrome) {\n            if (await checkExtension(verityHostname)) {\n                showQuiz();\n            } else {\n                showBlockPage(verityHostname, \"download-instructions\");\n            }\n        } else {\n            showBlockPage(verityHostname, \"browser-instructions\");\n        }\n    } catch (err) {\n    }\n}"],"names":["checkExtension","verityHostname","Promise","resolve","reject","iframe","document","createElement","id","style","display","visibility","src","body","appendChild","onload","contentWindow","postMessage","require","onerror","window","addEventListener","ev","origin","message","data","Boolean","result","showBlockPage","blockPage","quizDisplay","getElementById","notice","width","offsetWidth","scrolling","border","transition","height","paddingLeft","paddingRight","parentNode","event","authLink","undefined","scrollHeight","scrollWidth","noScroll","documentElement","scrollTop","showQuiz","classList","remove","chrome"],"mappings":"moBAKSA,eAAeC,uBACb,IAAIC,SAAQ,SAACC,QAASC,YACrBC,OAASC,SAASC,cAAc,UACpCF,OAAOG,GAAK,gCACZH,OAAOI,MAAMC,QAAU,OACvBL,OAAOI,MAAME,WAAa,SAC1BN,OAAOO,IAAM,WAAaX,eAAiB,2CAC3CK,SAASO,KAAKC,YAAYT,QAC1BA,OAAOU,OAAS,mEACZV,OAAOW,sEAAeC,YAAY,CAC9BC,QAAS,UACV,WAAajB,iBAEpBI,OAAOc,QAAU,WACbf,UAEJgB,OAAOC,iBAAiB,WAAW,SAACC,OAC5BA,GAAGC,SAAW,WAAatB,oBAIzBuB,QAAUF,GAAGG,KACM,YAArBD,MAAAA,eAAAA,QAASN,UACTf,QAAQuB,QAAQF,QAAQG,yBAW/BC,cAAc3B,eAAgB4B,eAC/BC,YAAcxB,SAASyB,eAAe,sBACrCD,iBAIDE,OAAS1B,SAASC,cAAc,UACpCyB,OAAOxB,GAAK,6BACZwB,OAAOC,MAAQH,YAAYI,YAC3BF,OAAOG,UAAY,KACnBH,OAAOpB,IAAM,WAAaX,eAAiB,iCAAmC4B,UAAY,mBAC1FG,OAAOvB,MAAM2B,OAAS,OACtBJ,OAAOvB,MAAM4B,WAAa,0BAC1BL,OAAOM,OAAS,MAChBN,OAAOC,MAAQ,OACfD,OAAOvB,MAAM8B,YAAc,OAC3BP,OAAOvB,MAAM+B,aAAe,OAE5BV,YAAYrB,MAAMC,QAAU,OAC5BoB,YAAYrB,MAAME,WAAa,SAC/BmB,YAAYW,WAAW3B,YAAYkB,QAEnCA,OAAOjB,OAAS,WACZiB,OAAOhB,cAAcC,YAAY,CAC7ByB,MAAO,yBACPC,cAAUC,GACX,WAAa3C,iBAIpBmB,OAAOC,iBAAiB,WAAW,SAACC,OAC5BA,GAAGC,SAAW,WAAatB,oBAIzBuB,QAAUF,GAAGG,KACI,yBAAnBD,MAAAA,eAAAA,QAASkB,SACLlB,QAAQqB,eACRb,OAAOM,OAASd,QAAQqB,cAExBrB,QAAQsB,cACRd,OAAOC,MAAQ,QAEdT,QAAQuB,WACTzC,SAAS0C,gBAAgBC,UAAY,kBAS5CC,WACL5C,SAASO,KAAKsC,UAAUC,OAAO,6GAO5B,iBAA+BnD,yIAE1BmB,OAAOiC,sDACGrD,eAAeC,gEACrBiD,wCAEAtB,cAAc3B,eAAgB,+DAGlC2B,cAAc3B,eAAgB"}