{"version":3,"file":"checkQuizAccess.min.js","sources":["../src/checkQuizAccess.js"],"sourcesContent":["function checkExtension(hostname) {\r\n    return new Promise((resolve, reject) => {\r\n        let iframe = document.createElement(\"iframe\");\r\n        iframe.id = \"yuja-verity-extension-connect\";\r\n        iframe.style.display = \"none\";\r\n        iframe.style.visibility = \"hidden\";\r\n        iframe.src = \"https://\" + hostname + \"/resources/themes/extension-connect.html\";\r\n        document.body.appendChild(iframe);\r\n        iframe.onload = () => {\r\n            iframe.contentWindow?.postMessage({\r\n                require: \"exists\"\r\n            }, \"https://\" + hostname);\r\n        };\r\n        iframe.onerror = () => {\r\n            reject();\r\n        };\r\n        window.addEventListener(\"message\", (ev) => {\r\n            if (ev.origin !== \"https://\" + hostname) {\r\n                console.debug(`Blocked message from origin ${ev.origin}`);\r\n                return;\r\n            }\r\n\r\n            const message = ev.data;\r\n            if (message?.require === \"exists\") {\r\n                resolve(Boolean(message.result));\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nfunction showBlockPage(hostname, blockPage) {\r\n    let quizDisplay = document.getElementById(\"region-main-box\");\r\n    if (!quizDisplay) {\r\n        return;\r\n    }\r\n\r\n    let notice = document.createElement(\"iframe\");\r\n    notice.id = \"yuja-download-instructions\";\r\n    notice.width = quizDisplay.offsetWidth;\r\n    notice.scrolling = \"no\";\r\n    notice.src = \"https://\" + hostname + \"/pages/take-quiz/block-access/\" + blockPage + \".html?lms=moodle\";\r\n    notice.style.border = \"none\";\r\n    notice.style.transition = \"all 0.5s ease-in-out 0s\";\r\n    notice.height = \"0px\";\r\n    notice.width = \"100%\";\r\n    notice.style.paddingLeft = \"15px\";\r\n    notice.style.paddingRight = \"15px\";\r\n\r\n    quizDisplay.style.display = \"none\";\r\n    quizDisplay.style.visibility = \"hidden\";\r\n    quizDisplay.parentNode.appendChild(notice);\r\n\r\n    notice.onload = () => {\r\n        notice.contentWindow.postMessage({\r\n            event: \"init-auth-instructions\",\r\n            authLink: undefined\r\n        }, \"https://\" + hostname);\r\n\r\n    };\r\n\r\n    window.addEventListener(\"message\", (ev) => {\r\n        if (ev.origin !== \"https://\" + hostname) {\r\n            console.debug(`Blocked message from origin ${ev.origin}`);\r\n            return;\r\n        }\r\n\r\n        const message = ev.data;\r\n        if (message?.event === \"instructions-resize\") {\r\n            if (message.scrollHeight) {\r\n                notice.height = message.scrollHeight;\r\n            }\r\n            if (message.scrollWidth) {\r\n                notice.width = \"100%\";\r\n            }\r\n            if (!message.noScroll) {\r\n                document.documentElement.scrollTop = 0;\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// course_module_viewed_handler in rule.php hides the form, so unhide it\r\nfunction showQuiz() {\r\n    document.body.classList.remove(\"yujaverity\");\r\n}\r\n\r\nfunction isTakeQuizPage() {\r\n    // This is determined by the plugin code in rule.php, so it should always return true\r\n    return true;\r\n}\r\n\r\nfunction isQuizProctored() {\r\n    // This is determined by the plugin code in rule.php, so it should always return true\r\n    return true;\r\n}\r\n\r\nexport async function checkQuizAccess(hostname) {\r\n    try {\r\n        if (isTakeQuizPage() && isQuizProctored()) {\r\n            if (window.chrome) {\r\n                if (await checkExtension(hostname)) {\r\n                    showQuiz();\r\n                }\r\n                else {\r\n                    showBlockPage(hostname, \"download-instructions\");\r\n                }\r\n            } else {\r\n                showBlockPage(hostname, \"browser-instructions\");\r\n            }\r\n        }\r\n    } catch (err) {\r\n        console.log(\"YuJa Verity encountered an error: \" + err);\r\n    }\r\n}"],"names":["checkExtension","hostname","Promise","resolve","reject","iframe","document","createElement","id","style","display","visibility","src","body","appendChild","onload","contentWindow","postMessage","require","onerror","window","addEventListener","ev","origin","message","data","Boolean","result","console","debug","showBlockPage","blockPage","quizDisplay","getElementById","notice","width","offsetWidth","scrolling","border","transition","height","paddingLeft","paddingRight","parentNode","event","authLink","undefined","scrollHeight","scrollWidth","noScroll","documentElement","scrollTop","showQuiz","classList","remove","chrome","log"],"mappings":"woBAASA,eAAeC,iBACb,IAAIC,SAAQ,SAACC,QAASC,YACrBC,OAASC,SAASC,cAAc,UACpCF,OAAOG,GAAK,gCACZH,OAAOI,MAAMC,QAAU,OACvBL,OAAOI,MAAME,WAAa,SAC1BN,OAAOO,IAAM,WAAaX,SAAW,2CACrCK,SAASO,KAAKC,YAAYT,QAC1BA,OAAOU,OAAS,mEACZV,OAAOW,sEAAeC,YAAY,CAC9BC,QAAS,UACV,WAAajB,WAEpBI,OAAOc,QAAU,WACbf,UAEJgB,OAAOC,iBAAiB,WAAW,SAACC,OAC5BA,GAAGC,SAAW,WAAatB,cAKzBuB,QAAUF,GAAGG,KACM,YAArBD,MAAAA,eAAAA,QAASN,UACTf,QAAQuB,QAAQF,QAAQG,cANxBC,QAAQC,4CAAqCP,GAAGC,wBAYvDO,cAAc7B,SAAU8B,eACzBC,YAAc1B,SAAS2B,eAAe,sBACrCD,iBAIDE,OAAS5B,SAASC,cAAc,UACpC2B,OAAO1B,GAAK,6BACZ0B,OAAOC,MAAQH,YAAYI,YAC3BF,OAAOG,UAAY,KACnBH,OAAOtB,IAAM,WAAaX,SAAW,iCAAmC8B,UAAY,mBACpFG,OAAOzB,MAAM6B,OAAS,OACtBJ,OAAOzB,MAAM8B,WAAa,0BAC1BL,OAAOM,OAAS,MAChBN,OAAOC,MAAQ,OACfD,OAAOzB,MAAMgC,YAAc,OAC3BP,OAAOzB,MAAMiC,aAAe,OAE5BV,YAAYvB,MAAMC,QAAU,OAC5BsB,YAAYvB,MAAME,WAAa,SAC/BqB,YAAYW,WAAW7B,YAAYoB,QAEnCA,OAAOnB,OAAS,WACZmB,OAAOlB,cAAcC,YAAY,CAC7B2B,MAAO,yBACPC,cAAUC,GACX,WAAa7C,WAIpBmB,OAAOC,iBAAiB,WAAW,SAACC,OAC5BA,GAAGC,SAAW,WAAatB,cAKzBuB,QAAUF,GAAGG,KACI,yBAAnBD,MAAAA,eAAAA,QAASoB,SACLpB,QAAQuB,eACRb,OAAOM,OAAShB,QAAQuB,cAExBvB,QAAQwB,cACRd,OAAOC,MAAQ,QAEdX,QAAQyB,WACT3C,SAAS4C,gBAAgBC,UAAY,SAbzCvB,QAAQC,4CAAqCP,GAAGC,sBAoBnD6B,WACL9C,SAASO,KAAKwC,UAAUC,OAAO,6GAa5B,iBAA+BrD,mIAGtBmB,OAAOmC,sDACGvD,eAAeC,0DACrBmD,yCAGAtB,cAAc7B,SAAU,gEAG5B6B,cAAc7B,SAAU,8GAIhC2B,QAAQ4B,IAAI"}