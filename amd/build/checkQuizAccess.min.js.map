{"version":3,"file":"checkQuizAccess.min.js","sources":["../src/checkQuizAccess.js"],"sourcesContent":["/**\n * Checks whether the YuJa Verity browser extension is enabled\n * @param {string} verityHostname hostname of Verity server\n * @returns {Promise<boolean>} whether the extension is enabled\n */\nfunction checkExtension(verityHostname) {\n    return new Promise((resolve, reject) => {\n        let iframe = document.createElement(\"iframe\");\n        iframe.id = \"yuja-verity-extension-connect\";\n        iframe.style.display = \"none\";\n        iframe.style.visibility = \"hidden\";\n        iframe.src = \"https://\" + verityHostname + \"/resources/themes/extension-connect.html\";\n        document.body.appendChild(iframe);\n        iframe.onload = () => {\n            iframe.contentWindow?.postMessage({\n                require: \"exists\"\n            }, \"https://\" + verityHostname);\n        };\n        iframe.onerror = () => {\n            reject();\n        };\n        window.addEventListener(\"message\", (ev) => {\n            if (ev.origin !== \"https://\" + verityHostname) {\n                return;\n            }\n\n            const message = ev.data;\n            if (message?.require === \"exists\") {\n                resolve(Boolean(message.result));\n            }\n        });\n    });\n}\n\n/**\n * Shows a page blocking access to the quiz\n * @param {string} verityHostname hostname of Verity server\n * @param {string} blockPage type of block page\n */\nfunction showBlockPage(verityHostname, blockPage) {\n    let quizDisplay = document.getElementById(\"region-main-box\");\n    if (!quizDisplay) {\n        return;\n    }\n\n    let notice = document.createElement(\"iframe\");\n    notice.id = \"yuja-download-instructions\";\n    notice.width = quizDisplay.offsetWidth;\n    notice.scrolling = \"no\";\n    notice.src = \"https://\" + verityHostname + \"/pages/take-quiz/block-access/\" + blockPage + \".html?lms=moodle\";\n    notice.style.border = \"none\";\n    notice.style.transition = \"all 0.5s ease-in-out 0s\";\n    notice.height = \"0px\";\n    notice.width = \"100%\";\n    notice.style.paddingLeft = \"15px\";\n    notice.style.paddingRight = \"15px\";\n\n    quizDisplay.style.display = \"none\";\n    quizDisplay.style.visibility = \"hidden\";\n    quizDisplay.parentNode.appendChild(notice);\n\n    notice.onload = () => {\n        notice.contentWindow.postMessage({\n            event: \"init-auth-instructions\",\n            authLink: undefined\n        }, \"https://\" + verityHostname);\n\n    };\n\n    window.addEventListener(\"message\", (ev) => {\n        if (ev.origin !== \"https://\" + verityHostname) {\n            return;\n        }\n\n        const message = ev.data;\n        if (message?.event === \"instructions-resize\") {\n            if (message.scrollHeight) {\n                notice.height = message.scrollHeight;\n            }\n            if (message.scrollWidth) {\n                notice.width = \"100%\";\n            }\n            if (!message.noScroll) {\n                document.documentElement.scrollTop = 0;\n            }\n        }\n    });\n}\n\n/**\n * Unhide the form hidden by course_module_viewed_handler in view_quiz.php\n */\nfunction showQuiz() {\n    document.body.classList.remove(\"yujaverity\");\n}\n\n/**\n * Hides quiz page and shows block page depending on user's browser (called from event)\n * @param {string} verityHostname hostname of Verity server\n */\nexport async function checkQuizAccess(verityHostname) {\n    try {\n        if (window.chrome) {\n            if (await checkExtension(verityHostname)) {\n                showQuiz();\n            } else {\n                showBlockPage(verityHostname, \"download-instructions\");\n            }\n        } else {\n            showBlockPage(verityHostname, \"browser-instructions\");\n        }\n    } catch (err) {\n        // Ignore error\n    }\n}"],"names":["showBlockPage","verityHostname","blockPage","quizDisplay","document","getElementById","notice","createElement","id","width","offsetWidth","scrolling","src","style","border","transition","height","paddingLeft","paddingRight","display","visibility","parentNode","appendChild","onload","contentWindow","postMessage","event","authLink","undefined","window","addEventListener","ev","origin","message","data","scrollHeight","scrollWidth","noScroll","documentElement","scrollTop","chrome","Promise","resolve","reject","iframe","body","require","onerror","Boolean","result","checkExtension","classList","remove","err"],"mappings":"mFAuCSA,cAAcC,eAAgBC,eAC/BC,YAAcC,SAASC,eAAe,uBACrCF,uBAIDG,OAASF,SAASG,cAAc,UACpCD,OAAOE,GAAK,6BACZF,OAAOG,MAAQN,YAAYO,YAC3BJ,OAAOK,UAAY,KACnBL,OAAOM,IAAM,WAAaX,eAAiB,iCAAmCC,UAAY,mBAC1FI,OAAOO,MAAMC,OAAS,OACtBR,OAAOO,MAAME,WAAa,0BAC1BT,OAAOU,OAAS,MAChBV,OAAOG,MAAQ,OACfH,OAAOO,MAAMI,YAAc,OAC3BX,OAAOO,MAAMK,aAAe,OAE5Bf,YAAYU,MAAMM,QAAU,OAC5BhB,YAAYU,MAAMO,WAAa,SAC/BjB,YAAYkB,WAAWC,YAAYhB,QAEnCA,OAAOiB,OAAS,KACZjB,OAAOkB,cAAcC,YAAY,CAC7BC,MAAO,yBACPC,cAAUC,GACX,WAAa3B,iBAIpB4B,OAAOC,iBAAiB,WAAYC,QAC5BA,GAAGC,SAAW,WAAa/B,4BAIzBgC,QAAUF,GAAGG,KACI,yBAAnBD,MAAAA,eAAAA,QAASP,SACLO,QAAQE,eACR7B,OAAOU,OAASiB,QAAQE,cAExBF,QAAQG,cACR9B,OAAOG,MAAQ,QAEdwB,QAAQI,WACTjC,SAASkC,gBAAgBC,UAAY,uGAiBftC,oBAE1B4B,OAAOW,sBAjGKvC,uBACb,IAAIwC,SAAQ,CAACC,QAASC,cACrBC,OAASxC,SAASG,cAAc,UACpCqC,OAAOpC,GAAK,gCACZoC,OAAO/B,MAAMM,QAAU,OACvByB,OAAO/B,MAAMO,WAAa,SAC1BwB,OAAOhC,IAAM,WAAaX,eAAiB,2CAC3CG,SAASyC,KAAKvB,YAAYsB,QAC1BA,OAAOrB,OAAS,6DACZqB,OAAOpB,sEAAeC,YAAY,CAC9BqB,QAAS,UACV,WAAa7C,iBAEpB2C,OAAOG,QAAU,KACbJ,UAEJd,OAAOC,iBAAiB,WAAYC,QAC5BA,GAAGC,SAAW,WAAa/B,4BAIzBgC,QAAUF,GAAGG,KACM,YAArBD,MAAAA,eAAAA,QAASa,UACTJ,QAAQM,QAAQf,QAAQgB,eA2ElBC,CAAejD,gBAVjCG,SAASyC,KAAKM,UAAUC,OAAO,cAanBpD,cAAcC,eAAgB,yBAGlCD,cAAcC,eAAgB,wBAEpC,MAAOoD"}